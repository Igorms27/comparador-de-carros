<div class="car-selector">
  <h3>{{ title }}</h3>

  <!-- Backdrop para dispositivos m√≥veis -->
  <div
    *ngIf="
      isMobileDevice() && (showBrandSuggestions || showModelSuggestions || showYearSuggestions)
    "
    class="mobile-backdrop"
    (click)="closeAllDropdowns()"
  ></div>

  <div
    class="select-group"
    [class.dropdown-open]="showBrandSuggestions && filteredBrands.length > 0"
    [class.mobile]="isMobileDevice()"
  >
    <label for="brandSearch">Marca do Ve√≠culo:</label>
    <div class="autocomplete-container">
      <div class="search-wrapper">
        <div class="input-with-logo" [class.has-logo]="selectedBrand">
          <span *ngIf="selectedBrand" class="input-icon">üöó</span>
          <input
            type="text"
            id="brandSearch"
            [(ngModel)]="brandSearch"
            (input)="filterBrands()"
            (focus)="showBrandOptions()"
            (click)="showBrandOptions()"
            placeholder="Digite a marca..."
            class="search-input"
            [class.with-logo]="selectedBrand"
            autocomplete="off"
          />
        </div>
        <span class="search-icon">üîç</span>
      </div>

      <!-- Dropdown para desktop -->
      <div
        *ngIf="!isMobileDevice() && showBrandSuggestions && filteredBrands.length > 0"
        class="suggestions-container"
        (click)="$event.stopPropagation()"
      >
        <div
          *ngFor="let brand of filteredBrands"
          class="suggestion-item"
          (click)="selectBrand(brand); $event.stopPropagation()"
          [class.active]="brand.codigo === selectedBrand"
        >
          <div class="brand-item">
            <span class="car-icon">üöó</span>
            <span>{{ brand.nome }}</span>
          </div>
        </div>
      </div>

      <!-- Dropdown para mobile -->
      <div
        *ngIf="isMobileDevice() && showBrandSuggestions && filteredBrands.length > 0"
        class="suggestions-container-mobile"
        (click)="$event.stopPropagation()"
      >
        <div class="mobile-dropdown-header">
          <div class="mobile-dropdown-title">Selecione a Marca</div>
          <button class="mobile-dropdown-close" (click)="closeAllDropdowns()">‚úï</button>
        </div>
        <div class="mobile-dropdown-content">
          <div
            *ngFor="let brand of filteredBrands"
            class="suggestion-item"
            (click)="selectBrand(brand); $event.stopPropagation()"
            [class.active]="brand.codigo === selectedBrand"
          >
            <div class="brand-item">
              <span class="car-icon">üöó</span>
              <span>{{ brand.nome }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div
    class="select-group"
    *ngIf="selectedBrand"
    [class.dropdown-open]="showModelSuggestions && filteredModels.length > 0"
    [class.mobile]="isMobileDevice()"
  >
    <label for="modelSearch">Modelo do Ve√≠culo:</label>
    <div class="autocomplete-container">
      <div class="search-wrapper">
        <input
          type="text"
          id="modelSearch"
          [(ngModel)]="modelSearch"
          (input)="filterModels()"
          (focus)="showModelOptions()"
          (click)="showModelOptions()"
          placeholder="Digite o modelo..."
          class="search-input"
          autocomplete="off"
        />
        <span class="search-icon">üîç</span>
      </div>

      <!-- Dropdown para desktop -->
      <div
        *ngIf="!isMobileDevice() && showModelSuggestions && filteredModels.length > 0"
        class="suggestions-container"
        (click)="$event.stopPropagation()"
      >
        <div
          *ngFor="let model of filteredModels"
          class="suggestion-item"
          (click)="selectModel(model); $event.stopPropagation()"
          [class.active]="model.codigo === selectedModel"
        >
          {{ model.nome }}
        </div>
      </div>

      <!-- Dropdown para mobile -->
      <div
        *ngIf="isMobileDevice() && showModelSuggestions && filteredModels.length > 0"
        class="suggestions-container-mobile"
        (click)="$event.stopPropagation()"
      >
        <div class="mobile-dropdown-header">
          <div class="mobile-dropdown-title">Selecione o Modelo</div>
          <button class="mobile-dropdown-close" (click)="closeAllDropdowns()">‚úï</button>
        </div>
        <div class="mobile-dropdown-content">
          <div
            *ngFor="let model of filteredModels"
            class="suggestion-item"
            (click)="selectModel(model); $event.stopPropagation()"
            [class.active]="model.codigo === selectedModel"
          >
            {{ model.nome }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <div
    class="select-group"
    *ngIf="selectedModel"
    [class.dropdown-open]="showYearSuggestions && filteredYears.length > 0"
    [class.mobile]="isMobileDevice()"
  >
    <label for="yearSearch">Ano do Ve√≠culo:</label>
    <div class="autocomplete-container">
      <div class="search-wrapper">
        <input
          type="text"
          id="yearSearch"
          [(ngModel)]="yearSearch"
          (input)="filterYears()"
          (focus)="showYearOptions()"
          (click)="showYearOptions()"
          placeholder="Digite o ano..."
          class="search-input"
          autocomplete="off"
        />
        <span class="search-icon">üîç</span>
      </div>

      <!-- Dropdown para desktop -->
      <div
        *ngIf="!isMobileDevice() && showYearSuggestions && filteredYears.length > 0"
        class="suggestions-container"
        (click)="$event.stopPropagation()"
      >
        <div
          *ngFor="let year of filteredYears"
          class="suggestion-item"
          (click)="selectYear(year); $event.stopPropagation()"
          [class.active]="year.codigo === selectedYear"
        >
          {{ year.nome }}
        </div>
      </div>

      <!-- Dropdown para mobile -->
      <div
        *ngIf="isMobileDevice() && showYearSuggestions && filteredYears.length > 0"
        class="suggestions-container-mobile"
        (click)="$event.stopPropagation()"
      >
        <div class="mobile-dropdown-header">
          <div class="mobile-dropdown-title">Selecione o Ano</div>
          <button class="mobile-dropdown-close" (click)="closeAllDropdowns()">‚úï</button>
        </div>
        <div class="mobile-dropdown-content">
          <div
            *ngFor="let year of filteredYears"
            class="suggestion-item"
            (click)="selectYear(year); $event.stopPropagation()"
            [class.active]="year.codigo === selectedYear"
          >
            {{ year.nome }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="error && !isRestoring" class="error">
    {{ error }}
  </div>
</div>
